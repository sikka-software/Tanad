# Making changes to the DB

- run the following command to create a new migration file

```
supabase migration new FILE_NAME
```

- add the sql query to the newly created file in `/supabase/migrations/FILE_NAME`
- run `supabase push` to apply the migrations to the db.

If any changes are made to `src/db/schema.ts` or `src/db/relations.ts` then we'll need to run `drizzle-kit generate` to generate the migrations files from the changes we made to the drizzle schema. And after that we can run `supabase push` to apply the migrations.

# Adding Permissions

The superadmin predefined role has the id: `e5a42bf8-12a8-4ac9-89f8-1f2ee46ed44b`

```
 insert into
  permissions (role_id, permission)
values
  (
    'e5a42bf8-12a8-4ac9-89f8-1f2ee46ed44b',
    'companies.read'
  ),
  (
    'e5a42bf8-12a8-4ac9-89f8-1f2ee46ed44b',
    'companies.create'
  ),
  (
    'e5a42bf8-12a8-4ac9-89f8-1f2ee46ed44b',
    'companies.delete'
  ),
  (
    'e5a42bf8-12a8-4ac9-89f8-1f2ee46ed44b',
    'companies.update'
  );
```



# Steps

- Define the change: Modify your schema in supabase/migrations/schema.ts using Drizzle's syntax. This file acts as the source of truth for your application's understanding of the database structure.

- (Optional but Recommended) Generate SQL: Run npx drizzle-kit generate --dialect postgresql (or similar, depending on your config). This command looks at your schema.ts changes and generates the corresponding SQL DDL statements. It usually saves them in a drizzle folder.

- Create Supabase Migration: Run supabase migrations new <your_migration_name>. This creates an empty SQL file in supabase/migrations/.

- Add SQL: Copy the SQL generated by drizzle-kit generate (from the drizzle folder) into the new file created by supabase migrations new. Alternatively, write the SQL manually if you prefer. Review the SQL carefully.

- Apply Migration: Run supabase db push --include-all (or supabase migration up --include-all) to apply the SQL migration to your Supabase database. This updates the actual database schema and keeps Supabase's migration history correct.